(window.webpackJsonp=window.webpackJsonp||[]).push([[26],{53:function(e,t,s){"use strict";s.r(t);var r=s(7),n={mixins:[r.a],mounted:function(){var e=this;setTimeout((function(){return e.shown=!0}));var t=this.$store.getters["ViewUser/getCheckList"],s=0;t.forEach((function(e){e.id>s&&(s=e.id)})),this.data.checks=[s]},data:function(){return{data:{user_quantity:1,role_id:"",permissions:{detections_check_access:!0,uiks_view_access:!0,events_view_access:!0,events_form_access:!0,stats_view_access:!0},checks:[]},rules:{user_quantity:["required"],role_id:["required"]},labels:{user_quantity:"Количество пользователей",role_id:"Группа"},isLoading:!1,shown:!1}},computed:{computedForm:function(){var e=this;return[{id:1,type:"number",name:"user_quantity",label:"Количество пользователей:",desc:""},{id:2,type:"select",name:"role_id",label:"Группа:",desc:"",data:this.$store.getters["ViewUser/getRoleList"].map((function(e){return Object.assign(e,{value:String(e.id)})}))},{id:3,type:"toggle-list",name:"permissions",label:"Доступные полномочия:",desc:"",data:this.$store.getters["ViewUser/getPermissionList"]},{id:4,type:"toggle-list-checkbox",name:"checks",label:"Доступные проверки:",desc:"",data:this.$store.getters["ViewUser/getCheckList"]}].filter((function(t){return!(4===t.id&&"3"!==e.data.role_id)}))}},methods:{create:function(){var e=this;this.validate()&&(this.isLoading=!0,this.$store.dispatch("ViewUser/createUser",this.data).then((function(t){if(t.hasOwnProperty("errors"))e.errors=t.errors;else{e.errors=[],e.$emit("result",{text:"Пользователи успешно созданы!",className:"alert--success"});var s=document.createElement("a");s.href=t,s.click(),e.$emit("close")}e.isLoading=!1})))}}},o=s(0),i=Object(o.a)(n,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("popup",{attrs:{isLoading:e.isLoading,shown:e.shown},on:{close:function(t){return e.$emit("close")}},scopedSlots:e._u([{key:"header",fn:function(){return[e._v("Добавление новых пользователей")]},proxy:!0},{key:"body",fn:function(){return[s("alert",{attrs:{messages:e.errors}}),e._v(" "),s("v-form",{attrs:{forms:e.computedForm},model:{value:e.data,callback:function(t){e.data=t},expression:"data"}})]},proxy:!0},{key:"footer",fn:function(){return[s("button",{staticClass:"btn btn--primary ml-auto",on:{click:e.create}},[e._v("Добавить")])]},proxy:!0}])})}),[],!1,null,null,null).exports;var a={mixins:[r.a],props:{id:{type:Number,required:!0}},mounted:function(){var e=this;setTimeout((function(){return e.shown=!0})),this.isLoading=!0,this.$store.dispatch("ViewUser/updateUser",{id:this.id}).then((function(t){if(t.hasOwnProperty("errors"))e.errors=t.errors;else{var s=t.permissions.reduce((function(e,t){return Object.assign({},e,(s={},r=t.name,n=t.value,r in s?Object.defineProperty(s,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):s[r]=n,s));var s,r,n}),{});e.data={login:t.login,password:"",username:t.name,role_id:String(t.role_id),permissions:s,checks:[]}}e.isLoading=!1}))},data:function(){return{data:{login:"",password:"",username:"",role_id:"",permissions:{detections_check_access:!0,uiks_view_access:!0,events_view_access:!0,events_form_access:!0,stats_view_access:!0},checks:[]},rules:{user_quantity:["required"],role_id:["required"]},labels:{user_quantity:"Количество пользователей",role_id:"Группа"},isLoading:!1,shown:!1}},computed:{computedUser:function(){return this.$store.getters["ViewUser/getUser"]},computedForm:function(){var e=this;return[{id:1,type:"text",name:"login",label:"Логин:"},{id:2,type:"password",name:"password",label:"Пароль:"},{id:3,type:"text",name:"username",label:"Юзернейм:"},{id:4,type:"select",name:"role_id",label:"Группа:",data:this.$store.getters["ViewUser/getRoleList"].map((function(e){return Object.assign(e,{value:String(e.id)})}))},{id:5,type:"toggle-list",name:"permissions",label:"Доступные полномочия:",data:this.$store.getters["ViewUser/getPermissionList"]},{id:6,type:"toggle-list-checkbox",name:"checks",label:"Доступные проверки:",data:this.$store.getters["ViewUser/getCheckList"]}].filter((function(t){return!("checks"===t.name&&"3"!==e.data.role_id)}))}},methods:{edit:function(){var e=this;this.validate()&&(this.isLoading=!0,this.$store.dispatch("ViewUser/editUser",Object.assign({},this.data,{id:this.id})).then((function(t){t.hasOwnProperty("errors")?e.errors=t.errors:(e.errors=[],e.$emit("result",{text:"Пользователь с <strong>ID: ".concat(e.id,"</strong> успешно измненен!"),className:"alert--success"}),e.$emit("close")),e.isLoading=!1})))}}},l=Object(o.a)(a,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("popup",{attrs:{isLoading:e.isLoading,shown:e.shown},on:{close:function(t){return e.$emit("close")}},scopedSlots:e._u([{key:"header",fn:function(){return[e._v("Редактирование пользователя")]},proxy:!0},{key:"body",fn:function(){return[s("alert",{attrs:{messages:e.errors}}),e._v(" "),s("v-form",{attrs:{forms:e.computedForm},model:{value:e.data,callback:function(t){e.data=t},expression:"data"}})]},proxy:!0},{key:"footer",fn:function(){return[s("button",{staticClass:"btn btn--primary ml-auto",on:{click:e.edit}},[e._v("Редактировать")])]},proxy:!0}])})}),[],!1,null,null,null).exports,c={data:function(){return{isLoading:!1,shown:!1,errors:[]}},props:{ids:{type:Array,required:!0}},mounted:function(){var e=this;setTimeout((function(){return e.shown=!0}))},computed:{computedMessage:function(){return[{text:"IDs: <strong>".concat(this.ids.join(", "),"</strong>"),className:"alert--info"}]}},methods:{remove:function(){var e=this;this.isLoading=!0,this.$store.dispatch("ViewUser/deleteUser",{id:this.ids}).then((function(t){t.hasOwnProperty("errors")?e.errors=t.errors:(e.errors=[],e.$emit("result",{text:"Пользователи с IDs: <strong>".concat(e.ids.join(", "),"</strong> успешно удалены!"),className:"alert--success"}),e.$emit("close")),e.isLoading=!1}))}}},u={components:{UserCreate:i,UserEdit:l,UserDelete:Object(o.a)(c,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("popup",{attrs:{isLoading:e.isLoading,shown:e.shown},on:{close:function(t){return e.$emit("close")}},scopedSlots:e._u([{key:"header",fn:function(){return[e._v("Удаление пользователей")]},proxy:!0},{key:"body",fn:function(){return[s("alert",{attrs:{messages:e.errors.length?e.errors:e.computedMessage}}),e._v(" "),s("h4",[e._v("Вы уверены, что хотите удалить этого пользователя?")])]},proxy:!0},{key:"footer",fn:function(){return[s("button",{staticClass:"btn btn--light ml-auto",on:{click:function(t){return e.$emit("close")}}},[e._v("Отменить")]),e._v(" "),s("button",{staticClass:"btn btn--danger ml-1",on:{click:e.remove}},[e._v("Удалить")])]},proxy:!0}])})}),[],!1,null,null,null).exports},data:function(){return{userIds:[],lastId:null,modal:{create:!1,edit:{show:!1,id:null},delete:{show:!1,ids:[]}},result:[]}},mounted:function(){document.addEventListener("keydown",(function(e){"Shift"===e.key&&(document.querySelector("table").style.userSelect="none")})),document.addEventListener("keyup",(function(e){"Shift"===e.key&&(document.querySelector("table").style.userSelect="auto")}))},methods:{openModalCreate:function(){this.modal.create=!0},openModalEdit:function(e){this.modal.edit.id=e,this.modal.edit.show=!0},openModalDelete:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.modal.delete.ids=e?[e]:this.userIds,this.modal.delete.show=!0},getResult:function(e){this.userIds=[],this.lastId=null,this.result=[e]},selectRow:function(e){var t=this,s=Number(e.target.value);this.userIds.length&&this.lastId&&e.shiftKey&&(this.userIds=this.$refs.table.filteredData.map((function(e){return e.id})).filter((function(e){return e=Number(e),s>t.lastId?e>=t.lastId&&e<s:e<=t.lastId&&e>s}))),e.shiftKey||(this.lastId=e.target.checked?this.lastId:s)}},computed:{table:function(){var e={checkbox:"",key:"№",id:"ID",name:"Юзернейм",login:"Логин",role:"Группа",permissions:"Доступ",allowedChecks:"Проверки",recognitions:"Проверено распознаваний",violations:"Подано жалоб",createdBy:"Создан",actions:"Действия"},t=this.$store.getters["ViewUser/getUserList"].map((function(e,t){return{checkbox:"",key:t+1,id:e.id,name:e.name,login:e.login,role:e.role,permissions:e.permissions,allowedChecks:e.allowed_checks,recognitions:e.box_recognitions_count,violations:e.violation_status_changes_count,createdBy:e.created_by,actions:""}}));return{data:t,options:{headings:e,_data:t,sortByColumn:!0,sortable:["key","date"]},columns:Object.keys(e)}}}},d=Object(o.a)(u,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"layout__container"},[s("alert",{attrs:{messages:e.result}}),e._v(" "),s("card",{scopedSlots:e._u([{key:"title",fn:function(){return[e._v("Список пользователей")]},proxy:!0}])},[e._v(" "),s("v-client-table",{ref:"table",attrs:{data:e.table.data,columns:e.table.columns,options:e.table.options},scopedSlots:e._u([{key:"afterLimit",fn:function(){return[s("button",{staticClass:"btn btn--primary mr-1",on:{click:e.openModalCreate}},[e._v("\n          Добавить пользователей\n        ")]),e._v(" "),s("button",{staticClass:"btn btn--danger",attrs:{disabled:!e.userIds.length},on:{click:function(t){return e.openModalDelete()}}},[e._v("\n          Удалить\n        ")])]},proxy:!0},{key:"checkbox",fn:function(t){return[s("input-checkbox",{attrs:{type:"blue",value:String(t.row.id)},on:{mousedown:e.selectRow},model:{value:e.userIds,callback:function(t){e.userIds=t},expression:"userIds"}})]}},{key:"permissions",fn:function(t){return[s("toggle-list",{attrs:{data:t.row.permissions}},[e._v("Ограничен ")])]}},{key:"allowedChecks",fn:function(t){return["all"===t.row.allowedChecks?[e._v("\n          Полный доступ\n        ")]:t.row.allowedChecks.length?s("toggle-checkbox-list",{attrs:{data:t.row.allowedChecks}},[e._v("Ограничен\n        ")]):[e._v("\n          Нет доступных проверок\n        ")]]}},{key:"actions",fn:function(t){return[s("a",{staticClass:"fa fa-edit",attrs:{href:"",title:"Редактировать"},on:{click:function(s){return s.preventDefault(),e.openModalEdit(t.row.id)}}},[s("unicon",{attrs:{name:"pen",fill:"royalblue"}})],1),e._v(" "),s("a",{staticClass:"fa fa-edit",attrs:{href:"",title:"Удалить"},on:{click:function(s){return s.preventDefault(),e.openModalDelete(t.row.id)}}},[s("unicon",{attrs:{name:"trash-alt",fill:"royalblue"}})],1)]}}])})],1),e._v(" "),e.modal.create?s("user-create",{on:{close:function(t){e.modal.create=!1},result:e.getResult}}):e._e(),e._v(" "),e.modal.edit.show?s("user-edit",{attrs:{id:e.modal.edit.id},on:{close:function(t){e.modal.edit.show=!1},result:e.getResult}}):e._e(),e._v(" "),e.modal.delete.show?s("user-delete",{attrs:{ids:e.modal.delete.ids},on:{close:function(t){e.modal.delete.show=!1},result:e.getResult}}):e._e()],1)}),[],!1,null,null,null);t.default=d.exports},7:function(e,t,s){"use strict";t.a={data:function(){return{errorMessages:{required:"Поле <strong></strong> обязательно для заполнения"},errors:[],rules:[],labels:[]}},methods:{generateMessage:function(e,t){if(this.errorMessages.hasOwnProperty(e)){var s=this.labels.hasOwnProperty(t)?this.labels[t]:t;return this.errorMessages[e].replace("<strong></strong>","<strong>".concat(s,"</strong>"))}},sendMessage:function(e,t){var s=this.generateMessage(e,t),r=this.errors.findIndex((function(e){return e===s}));this.$set(this.errors,-1!==r?r:this.errors.length,s)},deleteMessage:function(e,t){var s=this.generateMessage(e,t),r=this.errors.findIndex((function(e){return e===s}));-1!==r&&this.errors.splice(r,1)},validate:function(){var e=this,t=!0,s=function(s){if(e.rules.hasOwnProperty(s)&&e.data.hasOwnProperty(s)){var r=e.data[s];e.rules[s].forEach((function(n){"function"==typeof n&&!1===n(r,e.data,e,s)&&(t=!1),e.ruleHandler.hasOwnProperty(n)&&!1===e.ruleHandler[n](r,e.data,e,s)&&(t=!1)}))}};for(var r in this.rules)s(r);return t}},computed:{ruleHandler:function(){return{required:function(e,t,s){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";if(Array.isArray(e)&&!e.length||!e)return s.sendMessage("required",r),!1;e===Object(e)||s.deleteMessage("required",r)},callback:function(e,t,s){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";console.log(e,t,s,r)}}}}}}}]);
//# sourceMappingURL=26.chunk.js.map